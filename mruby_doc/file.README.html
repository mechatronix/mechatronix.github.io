<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><h1>Introduction to pins functionality</h1>

<p>The <code>pins</code> command is a multi-language interpreter used for dealing with C/C++ code generated by XOptima Maple module.</p>

<p>It has three main functionalities:</p>

<ol>
<li>compile the generated code into a dynamic library and a static library, to be used by custom code written by the user</li>
<li>provide a powerful way for describing problem data as ruby scripts that are loaded by the library generated in the previous step</li>
<li>allow to quickly write a script using the flexible and powerful ruby language that dynamically links at runtime with the problem dynamic library generated in 1. and control the execution of the solver, manage the output, and even plan and run parametric investigations.</li>
</ol>

<p><strong>NOTE</strong> the main language provided by <code>pins</code> is Ruby, although the interpreter itself is <em>mruby</em>, which is an embedded, simplified, and faster version of it. The syntax is compatible to Ruby 1.9, although the interpreter has some notable difference, including the lack of support for Ruby gems (libraries).</p>

<p>The powerful mechanism described in 3. is enabled by the fact that the dynamic library generated by XOptima also includes C entry points that allow the mruby interpreter to dynamically load the compiled library at runtime (via dlopen). This works regardless of the platform. </p>

<p>Nothe though that, if the ruby scripts are portable amongst different platforms, the <em>compiled</em> dynamic libraries are not, and you will need to recompile the source code for each platform. The code generated by Maple/XOptima, though, can be moved to a different platform and recompiled without editing.</p>

<p>The <code>pins</code> command also embeds a Lua 4.2 interpreter. This allows the user to also write data files in lua, although that interpreter currently does not offer the same functionalities as the Ruby one.</p>

<h2>Available libraries</h2>

<h3>Loading ruby scripts</h3>

<p>Mxint scripts can load other ruby files containing class definitions or providing problem data via the <code>Mechatronix.content</code> mechanism. Loading a file is performed with the <code>require</code> command:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>./lib/another_script</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># .rb extension is optional!
</span></code></pre>

<p>where the argument to require must be either an absolute path or the path <em>relative to the main executable script</em>. So if the script A requires the script B, which in turn needs to require the script C, the path to C in B must be relative to A.</p>

<p>Mxint comes with an utility function to always load a script at a path <em>relative to the current script</em>, rather than the main executable script. This function is <code>require_relative &quot;./another_script&quot;</code>.</p>

<h3>PINS standard libraries</h3>

<p>A number of utility libraries can be loaded, or &quot;required&quot;. These libraries are:</p>

<ul>
<li><code>require &quot;build&quot;</code>: support automatic build of C++ files</li>
<li><code>require &quot;colorize&quot;</code>: print coloured strings on terminal</li>
<li><code>require &quot;parametric_analysis&quot;</code>: automate parametric analysis</li>
</ul>

<p>Note that requiring these libraries does not need a full path, just their name.</p>

<p>The user can customize some of these libraries and add more of his own to be loaded by name only. To do that, custom ruby files can be placed in the special system folder, whose path is system-dependent and can be obtained by issuing <code>pins -i</code> and looking for the <em>pins library path:</em> string.</p>

<p>That library folder also contains a file named <code>autoload.rb</code>. That file is automatically loaded upon launching <code>pins</code>, so that the user can customize that file by adding <code>require</code> commands for each library that ought to be automatically loaded. For example, if you want to have the colorize functionality always available, just add <code>require &quot;colorize&quot;</code> at the end of the <code>autoload.rb</code> file.</p>

<p><strong>NOTE:</strong> the <code>autoload.rb</code> script will be reset to default after each update of the Mechatronix install package, so remember to back it up before updates!</p>

<h2>Example script</h2>

<p>The following example corresponds to a simplified version of the basic template generated by XOptima.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'>#!/usr/bin/env pins
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mechatronix</span><span class='tstring_end'>&#39;</span></span>

<span class='comment'># Set the model name
</span><span class='id identifier rubyid_problem_name'>problem_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Train</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># Compile the scripts, unless the library already exists
</span><span class='comment'># the command line flag &#39;-f&#39; forces recompilation
</span><span class='kw'>if</span> <span class='op'>!</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lib/lib</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_problem_name'>problem_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>.dylib</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='const'>ARGV</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>-f</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>then</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>build</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_compiler'>compiler</span> <span class='op'>=</span> <span class='const'>MXBuilder</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_problem_name'>problem_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_compiler'>compiler</span><span class='period'>.</span><span class='id identifier rubyid_build'>build</span>
<span class='kw'>end</span>

<span class='comment'># load the data file
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>./data/Train_Data.rb</span><span class='tstring_end'>&#39;</span></span>

<span class='comment'># Link the library
</span><span class='id identifier rubyid_ocp'>ocp</span> <span class='op'>=</span> <span class='const'>Mechatronix</span><span class='op'>::</span><span class='const'>OCPSolver</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lib/lib</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_problem_name'>problem_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='const'>Mechatronix</span><span class='op'>::</span><span class='const'>DYLIB_EXT</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># Setup the solver
</span><span class='id identifier rubyid_ocp'>ocp</span><span class='period'>.</span><span class='id identifier rubyid_setup'>setup</span>

<span class='comment'># Calculate the OCP solution. Result is into ocp.ocp_solution
</span><span class='id identifier rubyid_ocp'>ocp</span><span class='period'>.</span><span class='id identifier rubyid_solve'>solve</span>

<span class='comment'># Write results
</span><span class='kw'>unless</span> <span class='id identifier rubyid_ocp'>ocp</span><span class='period'>.</span><span class='id identifier rubyid_ocp_solution'>ocp_solution</span><span class='lbracket'>[</span><span class='symbol'>:Error</span><span class='rbracket'>]</span> <span class='kw'>then</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_ocp'>ocp</span><span class='period'>.</span><span class='id identifier rubyid_ocp_solution'>ocp_solution</span><span class='lbracket'>[</span><span class='symbol'>:converged</span><span class='rbracket'>]</span> <span class='kw'>then</span>
    <span class='id identifier rubyid_ocp'>ocp</span><span class='period'>.</span><span class='id identifier rubyid_write_ocp_solution'>write_ocp_solution</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_problem_name'>problem_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_OCP_result.txt</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_ocp'>ocp</span><span class='period'>.</span><span class='id identifier rubyid_write_ocp_solution'>write_ocp_solution</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_problem_name'>problem_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_OCP_result_NOT_CONVERGED.txt</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>else</span>
  <span class='id identifier rubyid_ocp'>ocp</span><span class='period'>.</span><span class='id identifier rubyid_write_ocp_solution'>write_ocp_solution</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_problem_name'>problem_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>_OCP_result_NOT_CONVERGED.txt</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ocp'>ocp</span><span class='period'>.</span><span class='id identifier rubyid_ocp_solution'>ocp_solution</span><span class='lbracket'>[</span><span class='symbol'>:Error</span><span class='rbracket'>]</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_figlet'>figlet</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>All Done Folks!</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<h2>Example data file</h2>

<p>The following is a typical data file generated by the Maple Xoptima package. It allows a flexible and maintainable definition of model parameters and solver configuration. You can freely intermix code and data, define intermediate variables and set model parameters to computed values.</p>

<p><strong>IMPORTANT NOTE</strong>: See <a href="file.DATA_FILES.html">this intro</a> for how to properly use data files.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_include'>include</span> <span class='const'>Mechatronix</span>

<span class='comment'># Auxiliary values
</span><span class='id identifier rubyid_epsi_max'>epsi_max</span> <span class='op'>=</span> <span class='float'>0.01</span>
<span class='id identifier rubyid_tol_max'>tol_max</span>  <span class='op'>=</span> <span class='float'>0.01</span>
<span class='id identifier rubyid_ubMax'>ubMax</span>    <span class='op'>=</span> <span class='int'>2</span>
<span class='id identifier rubyid_uaMax'>uaMax</span>    <span class='op'>=</span> <span class='int'>10</span>


<span class='id identifier rubyid_mechatronix'>mechatronix</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_data'>data</span><span class='op'>|</span>

  <span class='comment'># Level of message
</span>  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>LU_method</span> <span class='op'>=</span> <span class='const'>LU_automatic</span>

  <span class='comment'># Enable doctor
</span>  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>Doctor</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='comment'># Level of message
</span>  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>InfoLevel</span> <span class='op'>=</span> <span class='int'>4</span>

  <span class='comment'># setup solver
</span>  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>Solver</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:max_iter</span>  <span class='op'>=&gt;</span> <span class='int'>300</span><span class='comma'>,</span>  
    <span class='symbol'>:tolerance</span> <span class='op'>=&gt;</span> <span class='float'>1e-9</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>

  <span class='comment'># Boundary Conditions
</span>  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>BoundaryConditions</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:initial_x</span> <span class='op'>=&gt;</span> <span class='const'>SET</span><span class='comma'>,</span>
    <span class='symbol'>:initial_v</span> <span class='op'>=&gt;</span> <span class='const'>SET</span><span class='comma'>,</span>
    <span class='symbol'>:final_x</span>   <span class='op'>=&gt;</span> <span class='const'>SET</span><span class='comma'>,</span>
    <span class='symbol'>:final_v</span>   <span class='op'>=&gt;</span> <span class='const'>SET</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>Parameters</span> <span class='op'>=</span> <span class='lbrace'>{</span>

    <span class='comment'># Model Parameters
</span>    <span class='symbol'>:alpha</span> <span class='op'>=&gt;</span> <span class='float'>0.3</span><span class='comma'>,</span>
    <span class='symbol'>:beta</span>  <span class='op'>=&gt;</span> <span class='float'>0.14</span><span class='comma'>,</span>
    <span class='symbol'>:gm</span>    <span class='op'>=&gt;</span> <span class='float'>0.16</span><span class='comma'>,</span>
    <span class='symbol'>:uaMax</span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span>
    <span class='symbol'>:ubMax</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>

    <span class='comment'># Guess Parameters
</span>
    <span class='comment'># Boundary Conditions
</span>    <span class='symbol'>:v_f</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>
    <span class='symbol'>:v_i</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>
    <span class='symbol'>:x_f</span> <span class='op'>=&gt;</span> <span class='int'>6</span><span class='comma'>,</span>
    <span class='symbol'>:x_i</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>

    <span class='comment'># Post Processing Parameters
</span>
    <span class='comment'># User Function Parameters
</span>
    <span class='comment'># Continuation Parameters
</span>    <span class='symbol'>:tol_max</span>  <span class='op'>=&gt;</span> <span class='float'>0.01</span><span class='comma'>,</span>
    <span class='symbol'>:tol_min</span>  <span class='op'>=&gt;</span> <span class='float'>0.001</span><span class='comma'>,</span>
    <span class='symbol'>:epsi_max</span> <span class='op'>=&gt;</span> <span class='float'>0.01</span><span class='comma'>,</span>
    <span class='symbol'>:epsi_min</span> <span class='op'>=&gt;</span> <span class='float'>0.0001</span><span class='comma'>,</span>

    <span class='comment'># Constraints Parameters
</span>  <span class='rbrace'>}</span>

  <span class='comment'># functions mapped on objects
</span>  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>MappedObjects</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='comment'># Controls
</span>  <span class='comment'># Penalty type controls: U_QUADRATIC, U_QUADRATIC2, U_PARABOLA, U_CUBIC
</span>  <span class='comment'># Barrier type controls: U_LOGARITHMIC, U_COS_LOGARITHMIC, U_HYPERBOLIC
</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>Controls</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>Controls</span><span class='lbracket'>[</span><span class='symbol'>:uaControl</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:type</span>      <span class='op'>=&gt;</span> <span class='const'>U_COS_LOGARITHMIC</span><span class='comma'>,</span>
    <span class='symbol'>:epsilon</span>   <span class='op'>=&gt;</span> <span class='id identifier rubyid_epsi_max'>epsi_max</span><span class='comma'>,</span>
    <span class='symbol'>:tolerance</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_tol_max'>tol_max</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>Controls</span><span class='lbracket'>[</span><span class='symbol'>:ubControl</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:type</span>      <span class='op'>=&gt;</span> <span class='const'>U_COS_LOGARITHMIC</span><span class='comma'>,</span>
    <span class='symbol'>:epsilon</span>   <span class='op'>=&gt;</span> <span class='id identifier rubyid_epsi_max'>epsi_max</span><span class='comma'>,</span>
    <span class='symbol'>:tolerance</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_tol_max'>tol_max</span>
  <span class='rbrace'>}</span>


  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>Constraints</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='comment'># Constraint1D: none defined
</span>  <span class='comment'># Constraint2D: none defined
</span>
  <span class='comment'># User defined classes initialization
</span>  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='const'>Mesh</span> <span class='op'>=</span> 
  <span class='lbrace'>{</span>
    <span class='symbol'>:s0</span>       <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>
    <span class='symbol'>:segments</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span>

      <span class='lbrace'>{</span>
        <span class='symbol'>:n</span>      <span class='op'>=&gt;</span> <span class='int'>25</span><span class='comma'>,</span>
        <span class='symbol'>:length</span> <span class='op'>=&gt;</span> <span class='float'>0.25</span><span class='comma'>,</span>
      <span class='rbrace'>}</span><span class='comma'>,</span>

      <span class='lbrace'>{</span>
        <span class='symbol'>:n</span>      <span class='op'>=&gt;</span> <span class='int'>3000</span><span class='comma'>,</span>
        <span class='symbol'>:length</span> <span class='op'>=&gt;</span> <span class='float'>0.75</span><span class='comma'>,</span>
      <span class='rbrace'>}</span><span class='comma'>,</span>

      <span class='lbrace'>{</span>
        <span class='symbol'>:n</span>      <span class='op'>=&gt;</span> <span class='int'>100</span><span class='comma'>,</span>
        <span class='symbol'>:length</span> <span class='op'>=&gt;</span> <span class='float'>3.8</span><span class='comma'>,</span>
      <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='rbrace'>}</span> <span class='semicolon'>;</span>


<span class='kw'>end</span>

<span class='comment'># user function classes initializations
</span><span class='comment'># EOF
</span></code></pre>
</div></div>

    <div id="footer">
  Generated on Mon May  4 15:35:24 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.0.0).
</div>

  </body>
</html>